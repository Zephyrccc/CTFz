import{k as $e,m as H,d as P,x as we,y as k,a1 as Se,a2 as Ae,a3 as Fe,a4 as Ee,a5 as Te,a6 as Le,q,o as _,c as $,C as E,D as f,f as v,F as U,K as ee,Y as N,S as Be,L as S,B as L,w as d,a7 as Ve,G as le,W as De,r as A,h as Y,a8 as Ne,a9 as Pe,aa as j,ab as Z,a as c,ac as se,ad as Oe,ae as Re,t as B,af as x,ag as Ue,T as re,ah as M,ai as te,s as ue,aj as je,ak as Me,u as ie,_ as G,b,X as ce,J as de,I as me,E as fe,p as pe,e as ge,al as ze,am as Ye,an as We,ao as qe,A as xe,ap as Ge,aq as He,ar as K,as as ne,at as Ke,i as z,au as Ze,av as Je,aw as Xe}from"./index-f48438ef.js";import{b as he,a as ve}from"./col-a1fd19f5.js";import{E as X}from"./card-a156ac9e.js";import{h as _e}from"./moment-fbc5633a.js";import{a as Q,E as Qe}from"./select-6478868a.js";import{E as Ce}from"./input-86eb12f4.js";import{E as et}from"./divider-91fb6dfc.js";import{E as be}from"./button-f8fb6abb.js";import{E as tt}from"./rate-233716e2.js";const nt=$e({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:e=>e>=0&&e<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:{type:Boolean,default:!1},duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:H(String),default:"round"},textInside:{type:Boolean,default:!1},width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:H([String,Array,Function]),default:""},format:{type:H(Function),default:e=>`${e}%`}}),at=["aria-valuenow"],ot={viewBox:"0 0 100 100"},lt=["d","stroke","stroke-width"],st=["d","stroke","opacity","stroke-linecap","stroke-width"],rt={key:0},ut=P({name:"ElProgress"}),it=P({...ut,props:nt,setup(e){const t=e,a={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},n=we("progress"),r=k(()=>({width:`${t.percentage}%`,animationDuration:`${t.duration}s`,backgroundColor:D(t.percentage)})),s=k(()=>(t.strokeWidth/t.width*100).toFixed(1)),u=k(()=>["circle","dashboard"].includes(t.type)?Number.parseInt(`${50-Number.parseFloat(s.value)/2}`,10):0),g=k(()=>{const l=u.value,w=t.type==="dashboard";return`
          M 50 50
          m 0 ${w?"":"-"}${l}
          a ${l} ${l} 0 1 1 0 ${w?"-":""}${l*2}
          a ${l} ${l} 0 1 1 0 ${w?"":"-"}${l*2}
          `}),o=k(()=>2*Math.PI*u.value),m=k(()=>t.type==="dashboard"?.75:1),p=k(()=>`${-1*o.value*(1-m.value)/2}px`),y=k(()=>({strokeDasharray:`${o.value*m.value}px, ${o.value}px`,strokeDashoffset:p.value})),i=k(()=>({strokeDasharray:`${o.value*m.value*(t.percentage/100)}px, ${o.value}px`,strokeDashoffset:p.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"})),C=k(()=>{let l;return t.color?l=D(t.percentage):l=a[t.status]||a.default,l}),h=k(()=>t.status==="warning"?Se:t.type==="line"?t.status==="success"?Ae:Fe:t.status==="success"?Ee:Te),V=k(()=>t.type==="line"?12+t.strokeWidth*.4:t.width*.111111+2),T=k(()=>t.format(t.percentage));function O(l){const w=100/l.length;return l.map((F,R)=>q(F)?{color:F,percentage:(R+1)*w}:F).sort((F,R)=>F.percentage-R.percentage)}const D=l=>{var w;const{color:I}=t;if(Le(I))return I(l);if(q(I))return I;{const F=O(I);for(const R of F)if(R.percentage>l)return R.color;return(w=F[F.length-1])==null?void 0:w.color}};return(l,w)=>(_(),$("div",{class:E([f(n).b(),f(n).m(l.type),f(n).is(l.status),{[f(n).m("without-text")]:!l.showText,[f(n).m("text-inside")]:l.textInside}]),role:"progressbar","aria-valuenow":l.percentage,"aria-valuemin":"0","aria-valuemax":"100"},[l.type==="line"?(_(),$("div",{key:0,class:E(f(n).b("bar"))},[v("div",{class:E(f(n).be("bar","outer")),style:U({height:`${l.strokeWidth}px`})},[v("div",{class:E([f(n).be("bar","inner"),{[f(n).bem("bar","inner","indeterminate")]:l.indeterminate}]),style:U(f(r))},[(l.showText||l.$slots.default)&&l.textInside?(_(),$("div",{key:0,class:E(f(n).be("bar","innerText"))},[ee(l.$slots,"default",{percentage:l.percentage},()=>[v("span",null,S(f(T)),1)])],2)):N("v-if",!0)],6)],6)],2)):(_(),$("div",{key:1,class:E(f(n).b("circle")),style:U({height:`${l.width}px`,width:`${l.width}px`})},[(_(),$("svg",ot,[v("path",{class:E(f(n).be("circle","track")),d:f(g),stroke:`var(${f(n).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-width":f(s),fill:"none",style:U(f(y))},null,14,lt),v("path",{class:E(f(n).be("circle","path")),d:f(g),stroke:f(C),fill:"none",opacity:l.percentage?1:0,"stroke-linecap":l.strokeLinecap,"stroke-width":f(s),style:U(f(i))},null,14,st)]))],6)),(l.showText||l.$slots.default)&&!l.textInside?(_(),$("div",{key:2,class:E(f(n).e("text")),style:U({fontSize:`${f(V)}px`})},[ee(l.$slots,"default",{percentage:l.percentage},()=>[l.status?(_(),L(f(le),{key:1},{default:d(()=>[(_(),L(Ve(f(h))))]),_:1})):(_(),$("span",rt,S(f(T)),1))])],6)):N("v-if",!0)],10,at))}});var ct=Be(it,[["__file","/home/runner/work/element-plus/element-plus/packages/components/progress/src/progress.vue"]]);const dt=De(ct);function mt(e){let t;const a=A(!1),n=Y({...e,originalPosition:"",originalOverflow:"",visible:!1});function r(i){n.text=i}function s(){const i=n.parent,C=y.ns;if(!i.vLoadingAddClassList){let h=i.getAttribute("loading-number");h=Number.parseInt(h)-1,h?i.setAttribute("loading-number",h.toString()):(x(i,C.bm("parent","relative")),i.removeAttribute("loading-number")),x(i,C.bm("parent","hidden"))}u(),p.unmount()}function u(){var i,C;(C=(i=y.$el)==null?void 0:i.parentNode)==null||C.removeChild(y.$el)}function g(){var i;e.beforeClose&&!e.beforeClose()||(a.value=!0,clearTimeout(t),t=window.setTimeout(o,400),n.visible=!1,(i=e.closed)==null||i.call(e))}function o(){if(!a.value)return;const i=n.parent;a.value=!1,i.vLoadingAddClassList=void 0,s()}const m=P({name:"ElLoading",setup(i,{expose:C}){const{ns:h}=Ne("loading"),V=Pe();return C({ns:h,zIndex:V}),()=>{const T=n.spinner||n.svg,O=j("svg",{class:"circular",viewBox:n.svgViewBox?n.svgViewBox:"0 0 50 50",...T?{innerHTML:T}:{}},[j("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),D=n.text?j("p",{class:h.b("text")},[n.text]):void 0;return j(Oe,{name:h.b("fade"),onAfterLeave:o},{default:d(()=>[Z(c("div",{style:{backgroundColor:n.background||""},class:[h.b("mask"),n.customClass,n.fullscreen?"is-fullscreen":""]},[j("div",{class:h.b("spinner")},[O,D])]),[[se,n.visible]])])})}}}),p=Re(m),y=p.mount(document.createElement("div"));return{...B(n),setText:r,removeElLoadingChild:u,close:g,handleAfterLeave:o,vm:y,get $el(){return y.$el}}}let W;const ft=function(e={}){if(!Ue)return;const t=pt(e);if(t.fullscreen&&W)return W;const a=mt({...t,closed:()=>{var r;(r=t.closed)==null||r.call(t),t.fullscreen&&(W=void 0)}});gt(t,t.parent,a),ae(t,t.parent,a),t.parent.vLoadingAddClassList=()=>ae(t,t.parent,a);let n=t.parent.getAttribute("loading-number");return n?n=`${Number.parseInt(n)+1}`:n="1",t.parent.setAttribute("loading-number",n),t.parent.appendChild(a.$el),re(()=>a.visible.value=t.visible),t.fullscreen&&(W=a),a},pt=e=>{var t,a,n,r;let s;return q(e.target)?s=(t=document.querySelector(e.target))!=null?t:document.body:s=e.target||document.body,{parent:s===document.body||e.body?document.body:s,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:s===document.body&&((a=e.fullscreen)!=null?a:!0),lock:(n=e.lock)!=null?n:!1,customClass:e.customClass||"",visible:(r=e.visible)!=null?r:!0,target:s}},gt=async(e,t,a)=>{const{nextZIndex:n}=a.vm.zIndex,r={};if(e.fullscreen)a.originalPosition.value=M(document.body,"position"),a.originalOverflow.value=M(document.body,"overflow"),r.zIndex=n();else if(e.parent===document.body){a.originalPosition.value=M(document.body,"position"),await re();for(const s of["top","left"]){const u=s==="top"?"scrollTop":"scrollLeft";r[s]=`${e.target.getBoundingClientRect()[s]+document.body[u]+document.documentElement[u]-Number.parseInt(M(document.body,`margin-${s}`),10)}px`}for(const s of["height","width"])r[s]=`${e.target.getBoundingClientRect()[s]}px`}else a.originalPosition.value=M(t,"position");for(const[s,u]of Object.entries(r))a.$el.style[s]=u},ae=(e,t,a)=>{const n=a.vm.ns;["absolute","fixed","sticky"].includes(a.originalPosition.value)?x(t,n.bm("parent","relative")):te(t,n.bm("parent","relative")),e.fullscreen&&e.lock?te(t,n.bm("parent","hidden")):x(t,n.bm("parent","hidden"))},J=Symbol("ElLoading"),oe=(e,t)=>{var a,n,r,s;const u=t.instance,g=i=>ue(t.value)?t.value[i]:void 0,o=i=>{const C=q(i)&&(u==null?void 0:u[i])||i;return C&&A(C)},m=i=>o(g(i)||e.getAttribute(`element-loading-${Me(i)}`)),p=(a=g("fullscreen"))!=null?a:t.modifiers.fullscreen,y={text:m("text"),svg:m("svg"),svgViewBox:m("svgViewBox"),spinner:m("spinner"),background:m("background"),customClass:m("customClass"),fullscreen:p,target:(n=g("target"))!=null?n:p?void 0:e,body:(r=g("body"))!=null?r:t.modifiers.body,lock:(s=g("lock"))!=null?s:t.modifiers.lock};e[J]={options:y,instance:ft(y)}},ht=(e,t)=>{for(const a of Object.keys(t))je(t[a])&&(t[a].value=e[a])},vt={mounted(e,t){t.value&&oe(e,t)},updated(e,t){const a=e[J];t.oldValue!==t.value&&(t.value&&!t.oldValue?oe(e,t):t.value&&t.oldValue?ue(t.value)&&ht(t.value,a.options):a==null||a.instance.close())},unmounted(e){var t;(t=e[J])==null||t.instance.close()}},_t=P({name:"ChallengeProfile",props:{challengeInfo:{type:Object,default:()=>({})}},components:{},setup(e){const t=ie(),a=Y({formatTime:r=>_e(r).format("YYYY-MM-DD")}),n=k(()=>{var r,s;return!!((s=(r=t.state)==null?void 0:r.UserInfo)!=null&&s.solve_record.find(u=>u.challenge_id===e.challengeInfo.id))});return{...B(a),...B(e),isSloved:n}}});function Ct(e,t,a,n,r,s){const u=he,g=ve,o=Q,m=X;return e.challengeInfo?(_(),L(m,{key:0,class:"source-information"},{default:d(()=>[c(g,{justify:"space-evenly"},{default:d(()=>[c(u,{span:8},{default:d(()=>[b(" 上传用户： ")]),_:1}),c(u,{span:8},{default:d(()=>[b(" 管理员 ")]),_:1})]),_:1}),c(g,{justify:"space-evenly"},{default:d(()=>[c(u,{span:8},{default:d(()=>[b(" 上传时间： ")]),_:1}),c(u,{span:8},{default:d(()=>{var p;return[b(S(e.formatTime((p=e.challengeInfo)==null?void 0:p.created_time)),1)]}),_:1})]),_:1}),c(g,{justify:"space-evenly"},{default:d(()=>[c(u,{span:8},{default:d(()=>[b(" 题目状态： ")]),_:1}),c(u,{span:8},{default:d(()=>[e.isSloved?(_(),L(o,{key:0,type:"success",round:"",effect:"dark"},{default:d(()=>[b("已解出")]),_:1})):(_(),L(o,{key:1,type:"warning",round:"",effect:"dark"},{default:d(()=>[b("未解出")]),_:1}))]),_:1})]),_:1})]),_:1})):N("",!0)}const ye=G(_t,[["render",Ct],["__scopeId","data-v-8d18b763"]]),bt=P({name:"ChallengeComment",props:{challengeComment:{type:Object,default:()=>({})}},components:{},emits:["challengeCommentListChange","submitComment"],setup(e,t){const a=A(),n=A(""),r=A(1),s=Y({formatTime:u=>_e(u).format("YYYY年MM月DD日"),submitComment:()=>{n.value!==""&&(t.emit("submitComment",n.value),n.value="")}});return ce(r,u=>{t.emit("challengeCommentListChange",u)}),{commentText:n,currentPage:r,challengeInfo:a,...B(e),...B(s)}}});const yt=e=>(pe("data-v-2e060b65"),e=e(),ge(),e),kt={class:"upload-comment"},It={class:"comment-list"},$t=yt(()=>v("span",{class:"header"},"评论区",-1)),wt={class:"text"};function St(e,t,a,n,r,s){const u=Ce,g=be,o=et,m=fe,p=Q,y=Qe,i=X;return e.challengeComment?(_(),L(i,{key:0,class:"comment-main"},{default:d(()=>{var C;return[c(u,{modelValue:e.commentText,"onUpdate:modelValue":t[0]||(t[0]=h=>e.commentText=h),type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"输入您的评论......"},null,8,["modelValue"]),v("div",kt,[c(g,{type:"primary",onClick:e.submitComment},{default:d(()=>[b("提交")]),_:1},8,["onClick"])]),v("div",It,[c(o,null,{default:d(()=>[$t]),_:1}),(_(!0),$(me,null,de((C=e.challengeComment)==null?void 0:C.results,(h,V)=>(_(),$("div",{class:"comment-item",key:V},[c(m,{class:"user",href:"/user/"+h.user.id,target:"_blank",underline:!1},{default:d(()=>[b(S(h.user.username),1)]),_:2},1032,["href"]),c(p,{class:"time",effect:"plain",round:""},{default:d(()=>[b(S(e.formatTime(h.time)),1)]),_:2},1024),v("div",wt,S(h.content),1),c(o)]))),128)),c(y,{"current-page":e.currentPage,"onUpdate:currentPage":t[1]||(t[1]=h=>e.currentPage=h),small:"",background:"",layout:"prev, pager, next","page-size":15,total:e.challengeComment.count},null,8,["current-page","total"])])]}),_:1})):N("",!0)}const ke=G(bt,[["render",St],["__scopeId","data-v-2e060b65"]]);const At=P({name:"ChallengeProfile",props:{host:{type:Object,default:()=>({name:"http://127.0.0.1"})},challengeInfo:{type:Object,default:()=>({})},containerInfo:{type:Object,default:()=>({})},loading:{type:Boolean,default:()=>!1}},components:{Download:ze},emits:["addContainer","removeContainer","timeOut","flagSubmit"],setup(e,t){const a=A(""),n=k(()=>e.challengeInfo.difficulty),r=A(0),s=k(()=>e.challengeInfo.id===e.containerInfo.challenge),u=k(()=>Math.floor(r.value/e.containerInfo.time_limit*100)),g=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}];let o=null;ce(s,p=>{p&&(r.value=m.getTime(e.containerInfo.created_time,e.containerInfo.time_limit),o=setInterval(()=>{r.value>=0?r.value--:m.timeOut()},1e3))});const m=Y({getTime:(p,y)=>{const i=new Date(p),C=new Date(i.getTime()+y*1e3),h=new Date;return Math.floor((C.getTime()-h.getTime())/1e3)},timeOut:()=>{t.emit("timeOut"),clearInterval(o)},removeContainer:()=>{t.emit("removeContainer"),clearInterval(o)},addContainer:()=>{t.emit("addContainer")},submit:()=>{t.emit("flagSubmit",a.value),a.value=""}});return Ye(()=>{clearInterval(o)}),{time:r,colors:g,difficulty:n,flagValue:a,isChallengeSelf:s,percentage:u,...B(m),...B(e)}}});const Ft=e=>(pe("data-v-54d51418"),e=e(),ge(),e),Et={class:"title"},Tt={class:"body"},Lt={key:0},Bt={class:"footer"},Vt={class:"start"},Dt={key:0,class:"starting"},Nt=Ft(()=>v("span",null,"靶机地址：",-1)),Pt={class:"control-pannel"},Ot={class:"upload-flag"};function Rt(e,t,a,n,r,s){const u=tt,g=Q,o=We("Download"),m=le,p=be,y=fe,i=dt,C=Ce,h=X,V=vt;return e.challengeInfo?Z((_(),L(h,{key:0,class:"info"},{default:d(()=>{var T,O,D,l,w;return[v("div",Et,[v("span",null,S((T=e.challengeInfo)==null?void 0:T.title),1)]),v("div",Tt,[v("p",null,[b(" 难度： "),c(u,{modelValue:e.difficulty,"onUpdate:modelValue":t[0]||(t[0]=I=>e.difficulty=I),size:"default",disabled:"","show-score":"","score-template":"{value}"},null,8,["modelValue"])]),v("p",null,[b(" 标签： "),(_(!0),$(me,null,de((O=e.challengeInfo)==null?void 0:O.tag,I=>(_(),L(g,{key:I.id},{default:d(()=>[b(S(I.value),1)]),_:2},1024))),128))]),v("p",null,"分数： "+S((D=e.challengeInfo)==null?void 0:D.score),1),v("p",null,"描述： "+S((l=e.challengeInfo)==null?void 0:l.describe),1),(w=e.challengeInfo)!=null&&w.attachment?(_(),$("p",Lt,[b(" 附件： "),c(y,{href:e.challengeInfo.attachment,underline:!1},{default:d(()=>[c(p,{type:"primary"},{default:d(()=>[b(" 下载 "),c(m,null,{default:d(()=>[c(o)]),_:1})]),_:1})]),_:1},8,["href"])])):N("",!0)]),v("div",Bt,[Z(v("div",Vt,[c(p,{type:"primary",onClick:e.addContainer},{default:d(()=>[b(" 启动环境 ")]),_:1},8,["onClick"])],512),[[se,e.challengeInfo.environment_type&&!e.isChallengeSelf]]),e.isChallengeSelf?(_(),$("div",Dt,[v("div",null,[Nt,c(y,{type:"warning",href:e.host.name+":"+e.containerInfo.port,target:"_blank"},{default:d(()=>[b(S(e.host.name+":"+e.containerInfo.port),1)]),_:1},8,["href"])]),c(i,{type:"dashboard",percentage:e.percentage,color:e.colors},{default:d(()=>[v("span",null,"剩余:"+S(e.time)+"秒",1)]),_:1},8,["percentage","color"]),v("div",Pt,[c(p,{type:"danger",text:"",bg:"",onClick:e.removeContainer},{default:d(()=>[b("关闭环境")]),_:1},8,["onClick"])])])):N("",!0),v("div",Ot,[c(C,{modelValue:e.flagValue,"onUpdate:modelValue":t[1]||(t[1]=I=>e.flagValue=I),placeholder:"flag{......}"},{append:d(()=>[c(p,{type:"primary",onClick:e.submit},{default:d(()=>[b("提交")]),_:1},8,["onClick"])]),_:1},8,["modelValue"])])])]}),_:1})),[[V,e.loading]]):N("",!0)}const Ie=G(At,[["render",Rt],["__scopeId","data-v-54d51418"]]),Ut=P({name:"ChallengeView",props:{},components:{ChallengeProfile:Ie,ChallengeComment:ke,ChallengeSourceCard:ye},setup(){const e=qe(),t=ie(),a=A(!1),n=A(),r=A(),s=A(),u=A(),g=Y({loadAll:()=>{Ge().then(o=>{o.data.name?u.value=o.data:u.value={name:"http://127.0.0.1"}}),He(Number(e.params.id)).then(o=>{n.value=o.data}),K(Number(e.params.id)).then(o=>{r.value=o.data}),ne().then(o=>{s.value=o.data})},handleChallengeCommentListChange:o=>{K(Number(e.params.id),o).then(m=>{r.value=m.data})},handleAddContainer:()=>{a.value=!0,Ke(t.state.UserInfo.id,Number(e.params.id)).then(o=>{s.value=o.data,a.value=!1,z.success({title:"开启容器成功"})})},handleTimeOut:()=>{ne().then(o=>{s.value=o.data})},handleRemoveContainer:()=>{var o;Ze((o=s.value)==null?void 0:o.id).then(m=>{s.value=m.data,z.success({title:"关闭容器成功"})})},handleFlagSubmit:o=>{Je(t.state.UserInfo.id,Number(e.params.id),o).then(m=>{z.success({title:"解题成功",message:"flag正确"}),t.dispatch("UserInfo/updateUserInfo",t.state.UserInfo.id)},m=>{z.error({title:"解题失败",message:"flag错误"})})},handleSubmitComment:o=>{Xe(t.state.UserInfo.id,Number(e.params.id),o).then(m=>{K(Number(e.params.id)).then(p=>{r.value=p.data,z.success({title:"评论成功"})})})}});return xe(()=>{g.loadAll()}),{host:u,loading:a,challengeInfo:n,challengeComment:r,challengeContainer:s,...B(g)}}});const jt={class:"challenge"};function Mt(e,t,a,n,r,s){const u=Ie,g=ke,o=he,m=ye,p=ve;return _(),$("div",jt,[c(p,null,{default:d(()=>[c(o,{span:16},{default:d(()=>[c(u,{challengeInfo:e.challengeInfo,containerInfo:e.challengeContainer,host:e.host,onRemoveContainer:e.handleRemoveContainer,onTimeOut:e.handleTimeOut,onAddContainer:e.handleAddContainer,onFlagSubmit:e.handleFlagSubmit,loading:e.loading},null,8,["challengeInfo","containerInfo","host","onRemoveContainer","onTimeOut","onAddContainer","onFlagSubmit","loading"]),c(g,{class:"comment",challengeComment:e.challengeComment,onChallengeCommentListChange:e.handleChallengeCommentListChange,onSubmitComment:e.handleSubmitComment},null,8,["challengeComment","onChallengeCommentListChange","onSubmitComment"])]),_:1}),c(o,{span:8},{default:d(()=>[c(m,{challengeInfo:e.challengeInfo,class:"challenge-source"},null,8,["challengeInfo"])]),_:1})]),_:1})])}const Jt=G(Ut,[["render",Mt],["__scopeId","data-v-947b7965"]]);export{Jt as default};
